---
layout: title
title: 三翼校园微信公众号添加定制功能
date: 2017-07-03 00:23:46
tags: 
- 公众号
- 微信
categories: 
- 微信
- 公众号
thumbnail: http://osv9x79o9.bkt.clouddn.com/17-7-10/15097578.jpg
---
在腾讯微校中有“扩展”这样一栏，这个主要是用来支持用户的自定义功能或者第三方功能。三翼校园的“快捷查成绩”和“快捷查绩点”支持点击菜单直接返回成绩信息，主要也是借此功能实现的，这篇博客主要记录一下功能的大致实现逻辑，和三翼校园后台的消息转发流向。

![腾讯微校](/三翼校园微信公众号添加定制功能/weixiao.jpg)

## 功能基础逻辑
在微信后台有一个“服务器配置”，绑定好服务器后消息会转发到这个服务器（下文简称服务器1）上，一般来说会根据转发过来的消息来正则匹配然后回复，但是同时还有一个问题，那就是我们那个公众号使用了腾讯微校，也就说消息除了发一份给我们自己绑定的服务器，还会发一份到腾讯微校的服务器（下文简称服务器2）。如图：

![微信后台](/三翼校园微信公众号添加定制功能/wxht.jpg)
![消息转发方向](/三翼校园微信公众号添加定制功能/xaioxi.jpg)

其实这样也不是不可以，但是还有个问题，就是腾讯微校中“消息自动回复”的功能，这个功能主要是用在：当没有任何关键字能够匹配用户发来的消息时，便回复一段事先写好的消息。

![缺省回复](/三翼校园微信公众号添加定制功能/auto.jpg)

如果配置了这个功能，在这个点上问题就来了，如果把自定义功能配置在服务器1上，那么服务器1会回复一段处理后的结果，但同时服务器2也会回复事先定义好的那段缺省消息，也就是说在微信公众号的聊天窗口上，同时回复了两条消息，而服务器2的那条消息不是我们所需要的。

### 解决办法
解决办法的话主要有以下几种：
- 不使用任何第三方管理平台，用微信后台自带的关键词回复；
- 不配置第三方管理平台的“消息自动回复”的缺省回复功能；
- 将自定义功能部署到腾讯微校的“扩展”中，并关闭微信后台的“服务器配置”；

由于我们的公众号要使用掌上大学和腾讯微校等第三方管理平台给新媒体部门使用，缺省回复也要用于指导用户怎么样使用公众号的各种关键词回复，所以只能选择第三种方法，下面主要介绍如何使用腾讯微校的“扩展功能”

## 腾讯微校“扩展”——自定义功能
实现很简单，只有三个步骤：
1. 取到原来要设置在微信后台的服务器1上面的关键词回复脚本的链接；
2. 点击“添加扩展功能”填写信息，其中Token就是脚本中设置的token，不懂的话可以去看看怎样绑服务器1到微信后台的教程，这两个token的用法是其中用到的验证方法是一样的；
3. 点击“功能连接测试”，一般来说都是测试失败，不用管，继续添加就好了。

![添加扩张功能](/三翼校园微信公众号添加定制功能/kz.jpg)
